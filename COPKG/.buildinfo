#product-info  {
    product-name: "berkeleydb";
    version: "5.1.25";
    original-source-location: "";
    original-source-website: "http://www.oracle.com/technetwork/database/berkeleydb/downloads/index.html";
    license: "sleepycat";
    packager: "Vincent Povirk <madewokherd@gmail.com>";
}

x86 {
    compiler: vc10;
    platform: x86;
      
    targets: {
        "build_windows\Win32\Release\libdb51.lib",
        "build_windows\Win32\Release\libdb51.exp",
        "build_windows\Win32\Release\libdb51.dll",
        "build_windows\Win32\Release\libdb_sql51.lib",
        "build_windows\Win32\Release\libdb_sql51.exp",
        "build_windows\Win32\Release\libdb_sql51.dll",
        "build_windows\Win32\Release\libdb_stl51.lib",
        "build_windows\Win32\Release\libdb_stl51.exp",
        "build_windows\Win32\Release\libdb_stl51.dll",
        "build_windows\Win32\Release\dbsql.exe",
        "build_windows\Win32\Release\db_archive.exe",
        "build_windows\Win32\Release\db_checkpoint.exe",
        "build_windows\Win32\Release\db_deadlock.exe",
        "build_windows\Win32\Release\db_dump.exe",
        "build_windows\Win32\Release\db_hotbackup.exe",
        "build_windows\Win32\Release\db_load.exe",
        "build_windows\Win32\Release\db_log_verify.exe",
        "build_windows\Win32\Release\db_printlog.exe",
        "build_windows\Win32\Release\db_recover.exe",
        "build_windows\Win32\Release\db_replicate.exe",
        "build_windows\Win32\Release\db_sql_codegen.exe",
        "build_windows\Win32\Release\db_stat.exe",
        "build_windows\Win32\Release\db_upgrade.exe",
        "build_windows\Win32\Release\db_verify.exe"
    };
      
    build-command:@"
        msbuild /p:Platform=Win32 /p:Configuration=Release build_windows\Berkeley_DB_vs2010.sln
    ";
      
    clean-command:@"
        rmdir /S /Q build_windows\Win32 2>NUL
    ";
};

common-test {
    build-command:@"
        if exist *.db del /Q *.db
        dir /b | ${outdir}ex_access || goto failed
        ${outdir}db_verify access.db || goto failed
        ${outdir}db_dump access.db > access.dump || goto failed
        ${outdir}db_load test.db < access.dump || goto failed
        ${outdir}db_verify test.db || goto failed
        ${outdir}db_dump test.db > test.dump || goto failed
        echo n|comp /A /L access.dump test.dump || goto failed
        echo
        del /Q *.db *.dump
        rmdir /S /Q access.db-journal
    ";

    clean-command:@"
        del /Q *.db *.dump
        rmdir /S /Q access.db-journal
    ";
};

test-x86 {
    uses: { common-test };

    set: {
        outdir=@"build_windows\Win32\Release\";
    };
};

release {
    uses: { x86 };
};

test {
    uses: { release };

    build-command:@"
        ptk build test-x86
    ";

    clean-command:@"
        ptk clean test-x86
    ";
};
